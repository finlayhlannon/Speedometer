<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GPS Pace Calculator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #f4f4f4;
            flex-direction: column;
        }
        .container {
            text-align: center;
        }
        h1 {
            font-size: 80px;
            margin: 0;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1 id="paceDisplay">0:00 min/km</h1>
        <!-- Audio elements for the mp3s -->
        <audio id="fasterAudio" loop>
            <source src="faster.mp3" type="audio/mp3">
            Your browser does not support the audio tag.
        </audio>
        <audio id="slowerAudio" loop>
            <source src="slower.mp3" type="audio/mp3">
            Your browser does not support the audio tag.
        </audio>
        <audio id="goodAudio" loop>
            <source src="good.mp3" type="audio/mp3">
            Your browser does not support the audio tag.
        </audio>
    </div>

    <script>
        let watchID;
        let speedHistory = []; // Store recent speed readings for smoothing
        const maxHistoryLength = 5; // Number of speed readings to average

        const fasterAudio = document.getElementById("fasterAudio");
        const slowerAudio = document.getElementById("slowerAudio");
        const goodAudio = document.getElementById("goodAudio");

        // Automatically start tracking when the page loads
        window.onload = function() {
            startTracking();
        };

        function startTracking() {
            if ('geolocation' in navigator) {
                watchID = navigator.geolocation.watchPosition(calculatePace, handleError, {
                    enableHighAccuracy: true, // Request best possible accuracy
                    maximumAge: 1000,         // Maximum age of the cached position in ms
                    timeout: 10000            // Timeout in ms before error callback
                });
            }
        }

        function calculatePace(position) {
            const speedMps = position.coords.speed;

            if (speedMps !== null && speedMps > 0) {
                const speedKmh = speedMps * 3.6; // Convert m/s to km/h
                
                // Add current speed to history
                speedHistory.push(speedKmh);
                if (speedHistory.length > maxHistoryLength) {
                    speedHistory.shift(); // Keep only the last 'maxHistoryLength' values
                }
                
                // Calculate average speed for smoother display
                const averageSpeed = speedHistory.reduce((a, b) => a + b, 0) / speedHistory.length;
                
                // Convert km/h to minutes per kilometer
                const minutesPerKm = 60 / averageSpeed;
                const minutes = Math.floor(minutesPerKm);
                const seconds = Math.floor((minutesPerKm - minutes) * 60);

                // Display the pace in minutes and seconds
                document.getElementById('paceDisplay').innerHTML = `${minutes}:${seconds < 10 ? '0' : ''}${seconds} min/km`;

                // Determine which audio to play based on pace
                if (minutesPerKm > 4.5) {
                    playAudio("faster");
                } else if (minutesPerKm < 4) {
                    playAudio("slower");
                } else {
                    playAudio("good");
                }
            } else {
                document.getElementById('paceDisplay').innerHTML = "0:00 min/km";
                playAudio("good"); // Default to good if not moving
            }
        }

        function playAudio(type) {
            if (type === "faster") {
                if (fasterAudio.paused) {
                    fasterAudio.play();
                }
                slowerAudio.pause();
                goodAudio.pause();
            } else if (type === "slower") {
                if (slowerAudio.paused) {
                    slowerAudio.play();
                }
                fasterAudio.pause();
                goodAudio.pause();
            } else {
                if (goodAudio.paused) {
                    goodAudio.play();
                }
                fasterAudio.pause();
                slowerAudio.pause();
            }
        }

        function handleError(error) {
            document.getElementById('paceDisplay').innerHTML = "0:00 min/km"; // Show 0 if there is an error
            playAudio("good"); // Default to good if there is an error
        }
    </script>

</body>
</html>
